# # Development Caddyfile for Reqstly

# https://api.localhost {
#     reverse_proxy backend:3000

#     log {
#         output file /dev/stdout
#         format console
#     }
# }

# https://localhost {
#     # Health check endpoint for Caddy
#     handle /health {
#         header {
#             X-Service "caddy"
#             Content-Type application/json
#         }
#         respond `{"status":"ok","service":"caddy"}` 200
#     }

#     # Grafana dashboards
#     handle_path /grafana* {
#         reverse_proxy grafana:3000
#     }

#     # Backend metrics endpoint (for Prometheus)
#     handle /metrics* {
#         reverse_proxy backend:3000
#     }

#     # Frontend application (catch-all)
#     handle {
#         reverse_proxy frontend:5173
#     }

#     # Log to stdout for Docker log collection
#     log {
#         output file /dev/stdout
#         format console
#     }
# }
# Production Caddyfile for Reqstly

# Backend API
https://api.reqstly.com {
	tls /etc/caddy/certs/reqstly.pem /etc/caddy/certs/reqstly.key

	reverse_proxy backend:3000

	log {
		output file /dev/stdout
		format console
	}
}

# Main frontend + observability endpoints
https://reqstly.com {
	tls /etc/caddy/certs/reqstly.pem /etc/caddy/certs/reqstly.key

	# Health check endpoint
	handle /health {
		header {
			X-Service "caddy"
			Content-Type application/json
		}
		respond `{"status":"ok","service":"caddy"}` 200
	}

	# Grafana dashboards
	handle_path /grafana* {
		reverse_proxy grafana:3000
	}

	# Prometheus metrics
	handle /metrics* {
		reverse_proxy backend:3000
	}

	# Catch-all for frontend
	handle {
		reverse_proxy frontend:5173
	}

	# Log to stdout for Docker log collection
	log {
		output file /dev/stdout
		format console
	}
}
