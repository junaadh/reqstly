# Development Caddyfile for Reqstly
# HTTP only for local development - HTTPS configured for production

:80 {
    # Health check endpoint (direct response)
    handle /health {
        header {
            X-Service "caddy"
            Content-Type application/json
        }
        respond `{"status":"ok","service":"caddy"}` 200
    }

    # Grafana dashboards
    handle_path /grafana* {
        reverse_proxy grafana:3000
    }

    # Backend API endpoints
    handle_path /api* {
        reverse_proxy backend:3000
    }

    # Backend metrics endpoint (for Prometheus)
    handle /metrics* {
        reverse_proxy backend:3000
    }

    # Backend health check
    handle_path /health* {
        reverse_proxy backend:3000
    }

    # Frontend application (catch-all for SPA routing)
    handle / {
        reverse_proxy frontend:5173
    }

    # Log to stdout for Docker log collection
    log {
        output file /dev/stdout
        format console
    }
}
