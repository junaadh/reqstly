# Development Caddyfile for Reqstly
# HTTP only for local development - HTTPS configured for production
{
    auto_https off
}

http://api.localhost {
    reverse_proxy backend:3000

    log {
        output file /dev/stdout
        format console
    }
}

http://localhost {
    # Health check endpoint for Caddy
    handle /health {
        header {
            X-Service "caddy"
            Content-Type application/json
        }
        respond `{"status":"ok","service":"caddy"}` 200
    }

    # Grafana dashboards
    handle_path /grafana* {
        reverse_proxy grafana:3000
    }

    # Backend metrics endpoint (for Prometheus)
    handle /metrics* {
        reverse_proxy backend:3000
    }

    # Frontend application (catch-all)
    handle {
        reverse_proxy frontend:5173
    }

    # Log to stdout for Docker log collection
    log {
        output file /dev/stdout
        format console
    }
}
